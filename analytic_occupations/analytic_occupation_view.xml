<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>

        <record id="analytic_occupation_tree" model="ir.ui.view">
            <field name="name">account.analytic.occupation.tree</field>
            <field name="model">account.analytic.occupation</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Occupations">
                    <field name="name" string="Occupation"/>
                    <field name="employee_id"/>
                    <field name="date" string="Start Date"/>
                    <field name="duration"/>
                    <field name="end_date" string="Recur. end date" invisible="1"/>
                    <field name="toshow_end_date"/>
                    <field name="state"/>
                    <field name="partner_id"/>
                    <field name="freq"/>
                    <field name="interval"/>
                    <field name="end_type"/>
                    <field name="company_id"/>
                    <field name="description"/>
                    <field name="to_invoice"/>
                    <field name="old"/>
                </tree>
            </field>
        </record>

        <record id="analytic_occupation_form" model="ir.ui.view">
            <field name="name">account.analytic.occupation.form</field>
            <field name="model">account.analytic.occupation</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Occupation">
                    <field name="name" string="Occupation" required="1"/>
                    <field name="employee_id"/>
                    <group col="6" colspan="4">
                        <field name="date" string="Start Date" required="1" on_change="onchange_dates(date,duration,False,False)"/>
                        <field name="duration" required="1"
                        on_change="onchange_dates(date,duration,False,False)"/>
                        <field name="date_deadline" string="End Date" on_change="onchange_dates(date,False,date_deadline)"/>
                    </group>
                    <group colspan="4" col="6" attrs="{'readonly': ['|', ('recurrent_uid','!=',False), ('state','=','done')]}">
                           <field name="recurrency"/>
                           <field name="edit_all" attrs="{'invisible':[('recurrency','=', False)]}"
                                on_change="onchange_edit_all(rrule_type,edit_all)"/>
                            <field name="to_invoice"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Occupation">
                            <group colspan="4">
                                 <separator colspan="4" string="Origin"/>
                                 <field name="partner_id"/>
                                 <field name="analytic_account_id"/>
                                 <field name="company_id"/>
                                 <field name="rrule" invisible="1" readonly="1"/>
                                 <field name="recurrent_id" invisible="1"/>
                                 <field name="recurrent_uid" invisible="1"/>
                            </group>
                            <separator string="Description" colspan="4" />
                            <field name="description" nolabel="1" colspan="4" />
                            <separator colspan="4"/>
                            <group col="6" colspan="4" groups="base.group_extended">
                                <field name="state"/>
                                <button name="do_cancel" string="Cancel"
                                    states="tentative,confirmed" type="object"
                                    icon="gtk-cancel" />
                                <button name="do_confirm" string="Confirm"
                                    states="tentative" type="object"
                                    icon="gtk-go-forward" />
                                <field name="old"/>
                            </group>
                        </page>
                        <page string="Recurrency Option" attrs="{'invisible': [('recurrency','=',False)], 'readonly': ['|', ('recurrent_uid','!=',False), ('state','=','done')]}">
                            <group col="4" colspan="4" name="rrule">
                                <group col="4" colspan="4">
                                    <field name="rrule_type" string="Recurrency period" />
                                    <field name="interval" />
                                    <separator string="End of recurrency" colspan="4"/>
                                    <field name="end_type" />
                                    <label string=" " colspan="2" />
                                    <newline />
                                    <field name="count" attrs="{'invisible' : [('end_type', '!=', 'count')] }"/>
                                    <label string=" " colspan="2" />
                                    <newline />
                                    <field name="end_date" attrs="{'invisible' : [('end_type', '!=', 'end_date')] }"/>
                                    <newline />
                                </group>
                                <group col="8" colspan="4" name="Select weekdays">
                                    <field name="mo" colspan="1" />
                                    <field name="tu" colspan="1" />
                                    <field name="we" colspan="1" />
                                    <field name="th" colspan="1" />
                                    <newline/>
                                    <field name="fr" colspan="1" />
                                    <field name="sa" colspan="1"  />
                                    <field name="su" colspan="1"  />
                                    <newline />
                                    <separator string="Timetable" colspan="8"/>
                                    <field name="timetable_text" colspan="8" nolabel="1"/>
                                </group>
                                <group col="10" colspan="4"
                                    attrs="{'invisible' : [('rrule_type','!=','monthly')]}">
                                    <separator string="Choose day in the month where repeat the occupation" colspan="12"/>
                                    <group col="2" colspan="1">
                                        <field name="select1" />
                                    </group>
                                    <group col="2" colspan="1">
                                        <field name="day"
                                            attrs="{'required' : [('select1','=','date'), ('rrule_type','=','monthly')],
                                                'invisible' : [('select1','=','day')]}" />
                                    </group>
                                    <group col="3" colspan="1">
                                        <field name="byday" string="The"
                                            attrs="{'required' : [('select1','=','day'), ('rrule_type','=','monthly')], 'invisible' : [('select1','=','date')]}" />
                                        <field name="week_list" nolabel="1"
                                            attrs="{'required' : [('select1','=','day'), ('rrule_type','=','monthly')], 'invisible' : [('select1','=','date')]}" />
                                    </group>
                                </group>
                            </group>
                            </page>
                            <page string="Exception dates" attrs="{'invisible': [('recurrency','=',False)], 'readonly': ['|', ('recurrent_uid','!=',False), ('state','=','done')]}">
                            <group colspan="4" col="6">
                                    <field name="exception_date"/>
                                    <field name="exception_duration"/>
                                    <button name="add_exception_date" string="Add exception" type="object" icon="gtk-apply"/>
                            </group>
                            <separator string="Exceptions dates" colspan="4"/>
                            <field name="exdate" colspan="4" nolabel="1"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="analytic_occupation_calendar">
            <field name="name">analytic.occupation.calendar</field>
            <field name="model">account.analytic.occupation</field>
            <field name="type">calendar</field>
            <field name="priority" eval="2"/>
            <field name="arch" type="xml">
                <calendar string="Occupations" date_start="date" color="employee_id" date_stop="date_deadline">
                    <field name="analytic_account_id"/>
                    <field name="name"/>
                    <field name="partner_id"/>
                </calendar>
            </field>
        </record>

        <record id="analytic_occupation_gantt" model="ir.ui.view">
            <field name="name">analytic.occupation.gantt</field>
            <field name="model">account.analytic.occupation</field>
            <field name="type">gantt</field>
            <field name="arch" type="xml">
                <gantt color="employee_id" date_delay="duration" date_start="date" string="Occupations">
                   <level object="account.analytic.occupation" link="id" domain="[]">
                       <field name="name"/>
                       <field name="partner_id"/>
                       <field name="analytic_account_id"/>
                    </level>
                </gantt>
            </field>
        </record>

        <record id="analytic_occupation_filter" model="ir.ui.view">
        <field name="name">analytic.occupation.search</field>
        <field name="model">account.analytic.occupation</field>
        <field name="type">search</field>
        <field name="arch" type="xml">
                <search string="Search Occupations">
                       <group col="12" colspan="4">
                           <filter icon="terp-check" name="current" string="Current"
                                domain="[('state','in',('draft', 'open', 'replacement')),('old','=',False)]"
                                groups="base.group_extended"
                                help="Current Occupations"/>
                           <filter icon="terp-stock_effects-object-colorize" name="cancelled" string="Cancelled"
                                domain="[('state','=','cancelled')]"
                                groups="base.group_extended"
                                help="Cancelled occupations"/>
                           <separator orientation="vertical"/>
                           <field name="name" select="1" string="Subject"/>
                           <field name="analytic_account_id" select="1"/>
                           <field name="partner_id" select="1"/>
                           <separator orientation="vertical"/>
                           <field name="employee_id" select="1"/>
                           <field name="date" select="1"/>
                           <field name="old"/>
                       </group>
                       <newline/>
                       <group expand="0" string="Group By...">
                            <filter string="Employee" icon="terp-personal" domain="[]"
                                context="{'group_by':'employee_id'}" />
                            <separator orientation="vertical" />
                            <filter string="Company" icon="terp-folder-orange" domain="[]" context="{'group_by':'company_id'}"/>
                            <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]"
                                context="{'group_by':'state'}" />
                            <separator orientation="vertical" />
                            <filter string="Date" icon="terp-go-month" help="Occupation date"
                                domain="[]" context="{'group_by':'date'}" />
                        </group>
                </search>
            </field>
        </record>

     <act_window
        id="analytic_occupation_partner_link"
        name="Occupations"
        res_model="account.analytic.occupation"
        src_model="hr.employee"
        view_mode="calendar,tree,form,gantt"
        domain="[('employee_id', '=', active_id)]"
    />

    <record model="ir.actions.act_window" id="action_analytic_occupation">
        <field name="name">Occupations</field>
        <field name="res_model">account.analytic.occupation</field>
        <field name="view_mode">calendar,tree,form,gantt</field>
        <field name="view_id" ref="analytic_occupation_tree"/>
        <field name="search_view_id" ref="analytic_occupation_filter"/>
        <field name="context">{"search_default_current":1}</field>
    </record>

<!-- ALL OCCUPATIONS -->

    <menuitem name="Occupations" id="menu_occupations"
        parent="base.menu_base_partner" sequence="60"/>

    <menuitem name="Occupations" id="menu_occupations_calendar"
        action="action_analytic_occupation" parent="menu_occupations"
        sequence="1" />

    </data>
</openerp>
