<?xml version="1.0" encoding="utf-8"?>
<!-- © 2018 Comunitea
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl). -->
<odoo>

    <record id="base.paperformat_euro" model="report.paperformat">
        <field name="margin_top">45</field>
        <field name="header_spacing">43</field>
    </record>

    <template id="account_payment_sale.report_sale_payment_mode" inherit_id="sale.report_saleorder_document">
    </template>

    <template id="external_layout_standard_custom" inherit_id="web.external_layout_standard">
        <xpath expr="//div[@name='company_address']" position="replace">
             <div class="col-6" name="company_address">
                <span t-if="o and 'warehouse_id' in o and o.warehouse_id.partner_id" t-field="o.warehouse_id.partner_id"
                    t-options='{"widget": "contact", "fields": ["address", "name", "phone", "email"], "no_marker": true}'/>
                <div t-if="not o or 'warehouse_id' not in o or not o.warehouse_id.partner_id" t-field="company.partner_id"
                    t-options='{"widget": "contact", "fields": ["address", "name", "phone", "email"], "no_marker": true}'
                />
            </div>
        </xpath>
        <xpath expr="//div[hasclass('footer')]" position="attributes">
            <attribute name="style">font-size:10px;</attribute>
        </xpath>
        <xpath expr="//div[hasclass('header')]" position="attributes">
            <attribute name="style">font-size:12px;</attribute>
            <attribute name="t-att-style"></attribute>
        </xpath>
        <xpath expr="//div[hasclass('o_report_layout_standard')]" position="attributes">
            <attribute name="style">font-size: 12px;</attribute>
        </xpath>
    </template>

    <template id="custom_sale_report" inherit_id="sale_stock.report_saleorder_document_inherit_sale_stock">
        <xpath expr="//t[@t-set='display_discount']" position="after">
            <t t-if="doc.header_notes">
                <p><b t-field="doc.header_notes"/></p>
            </t>
        </xpath>
        <xpath expr="//t[@t-set='information_block']" position="replace">
            <t t-set="information_block"></t>
        </xpath>
        <xpath expr="//div[@class='page']/h2" position="replace">
            <h2>
                <t t-if="not (env.context.get('proforma', False) or is_pro_forma)">
                    <span>Presupuesto N° </span>
                </t>
                <t t-if="env.context.get('proforma', False) or is_pro_forma">
                    <span>Factura Proforma N° </span>
                </t>
                <span t-field="doc.name"/>
            </h2>
        </xpath>
        <xpath expr="//p[@t-field='doc.confirmation_date']" position="replace">
            <p class="m-0" t-field="doc.date_order" t-options='{"widget": "date"}'/>
        </xpath>
        <xpath expr="//p[@t-field='doc.date_order']" position="replace">
            <p class="m-0" t-field="doc.confirmation_date" t-options='{"widget": "date"}'/>
        </xpath>
        <xpath expr="//div[@t-if='doc.payment_term_id']" position="after">
            <div t-if="doc.payment_mode_id"  class="col-auto mw-100 mb-2">
                <strong>Forma de pago:</strong>
                <p class="m-0" t-field="doc.payment_mode_id"/>
            </div>
        </xpath>
        <xpath expr="//p[@t-if='doc.payment_term_id.note']" position="replace"/>
        <xpath expr="//div[@t-if='doc.user_id.name']" position="replace"/>
        <xpath expr="//p[@t-field='doc.note']" position="before">
            <t t-if="doc.very_important_text">
                <p><b>- Muy importante:</b></p>
                <p t-field="doc.very_important_text"/>
            </t>
            <t t-if="doc.note">
                <p><b>- Observaciones:</b></p>
            </t>
        </xpath>
        <xpath expr="//span[@t-field='line.product_uom_qty']" position="attributes">
            <attribute name="t-options">{"widget": "float", "precision": 3}</attribute>
        </xpath>
        <xpath expr="//div[@name='total']" position="replace">
            <div class="row" name="total">
                <div class="col-12 pull-right" t-if="doc.show_total">
                    <table class="table table-condensed">
                        <tr>
                            <td>
                                <span>Total neto :</span>
                            </td>
                            <td class="text-right">
                                 <span t-field="doc.amount_untaxed" t-if="not doc.periodicity_id"
                                    t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                <span t-field="doc.amount_untaxed_periodicity" t-if="doc.periodicity_id"
                                    t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                            </td>
                            <td>
                                <span>Impuestos :</span>
                            </td>
                            <td class="text-right">
                                 <span t-field="doc.amount_tax" t-if="not doc.periodicity_id"
                                    t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                <span t-field="doc.amount_tax_periodicity" t-if="doc.periodicity_id"
                                    t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                            </td>
                            <td>
                                <strong>Total :</strong>
                            </td>
                            <td class="text-right">
                                 <strong><span t-field="doc.amount_total" t-if="not doc.periodicity_id"
                                    t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                    <span t-field="doc.amount_total_periodicity" t-if="doc.periodicity_id"
                                    t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/></strong>

                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </xpath>
        <xpath expr="//thead" position="replace">
            <thead>
                <tr>
                    <t t-set="colspan" t-value="6"/>
                    <th class="text-left">Descripción</th>
                    <th class="text-right">Cantidad</th>
                    <th class="text-right">Precio unidad</th>
                    <th t-if="display_discount" class="text-right" groups="sale.group_discount_per_so_line">
                        <span>Desc.(%)</span>
                        <!-- TODO: remove in master -->
                        <t t-set="colspan" t-value="colspan+1"/>
                    </th>
                    <th class="text-right">Subtotal</th>
                    <th class="text-right" colspan="2">Importe IVA</th>
                </tr>
           </thead>
        </xpath>
        <xpath expr="//td[@t-if='display_discount']" position="after">
            <td class="text-right">
                <span t-field="line.price_subtotal"/>
            </td>
        </xpath>
        <xpath expr="//td[hasclass('o_price_total')]" position="replace">
            <td class="text-right o_price_total">
                <span t-field="line.price_tax"/>
            </td>
        </xpath>
        <xpath expr="//p[@id='fiscal_position_remark']" position="after">
            <div class="row" style="page-break-inside:avoid;">
                <div class="col-6" style="border: 1px solid black">
                    <p style="margin: 0;">Aceptación y conformidad de la oferta</p>
                    <p style="margin: 0;">Firma y Sello Responsable pedido:</p>
                    <div style="min-height: 80px"/>
                    <p style="margin: 0;">Nº cuenta _______________________________</p>
                </div>
                <div class="col-6" style="border: 1px solid black">
                    <p>Responsable:</p>
                    <div t-if="not doc.user_id.signature_image" style="min-height: 110px"/>
                    <img t-if="doc.user_id.signature_image" t-att-src="image_data_uri(doc.user_id.signature_image)" style="max-height: 110px;"/>
                </div>
            </div>
        </xpath>
    </template>

</odoo>
